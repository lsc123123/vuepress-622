(window.webpackJsonp=window.webpackJsonp||[]).push([[477],{804:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"semanage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#semanage"}},[s._v("#")]),s._v(" semanage")]),s._v(" "),a("p",[s._v("默认目录的安全上下文查询与修改")]),s._v(" "),a("h2",{attrs:{id:"补充说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#补充说明"}},[s._v("#")]),s._v(" 补充说明")]),s._v(" "),a("p",[a("strong",[s._v("semanage命令")]),s._v(" 是用来查询与修改SELinux默认目录的安全上下文。SELinux的策略与规则管理相关命令：seinfo命令、sesearch命令、getsebool命令、setsebool命令、semanage命令。")]),s._v(" "),a("h3",{attrs:{id:"语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#语法"}},[s._v("#")]),s._v(" 语法")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("semanage "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("login"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("interface"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("fcontext"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("translation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\nsemanage fcontext -"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-frst"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" file_spec\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选项"}},[s._v("#")]),s._v(" 选项")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("-l：查询。\nfcontext：主要用在安全上下文方面。\n-a：增加，你可以增加一些目录的默认安全上下文类型设置。\n-m：修改。\n-d：删除。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实例"}},[s._v("#")]),s._v(" 实例")]),s._v(" "),a("p",[s._v("查询一下"),a("code",[s._v("/var/www/html")]),s._v("的默认安全性本文的设置：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("semanage fcontext "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\nSELinux fcontext    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v("          Context\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("前面省略"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n/var/www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?      all files     system_u:object_r:httpd_sys_content_t:s0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("後面省略"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("如上面例子所示，我们可以查询的到每个目录的安全性本文！而目录的设定可以使用正则表达式去指定一个范围。那么如果我们想要增加某些自定义目录的安全性本文呢？举例来说，我想要色设置"),a("code",[s._v("/srv/samba")]),s._v("成为 "),a("code",[s._v("public_content_t")]),s._v("的类型时，应该如何设置呢？")]),s._v(" "),a("p",[s._v("用semanage命令设置"),a("code",[s._v("/srv/samba")]),s._v("目录的默认安全性本文为"),a("code",[s._v("public_content_t")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /srv/samba\nll "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Zd")]),s._v(" /srv/samba\ndrwxr-xr-x  root root root:object_r:var_t    /srv/samba\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("如上所示，默认的情况应该是"),a("code",[s._v("var_t")]),s._v("这个咚咚的！")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("semanage fcontext "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/srv'")]),s._v("\n/srv/.*                     all files   system_u:object_r:var_t:s0\n/srv/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("^/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("*/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?ftp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?     all files   system_u:object_r:public_content_t:s0\n/srv/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("^/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("*/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?     all files   system_u:object_r:httpd_sys_content_t:s0\n/srv/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("^/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("*/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?rsync"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?   all files   system_u:object_r:public_content_t:s0\n/srv/gallery2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?         all files   system_u:object_r:httpd_sys_content_t:s0\n/srv                        directory   system_u:object_r:var_t:s0   //看这里！\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("上面则是默认的"),a("code",[s._v("/srv")]),s._v("底下的安全性本文资料，不过，并没有指定到"),a("code",[s._v("/srv/samba")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("semanage fcontext "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" public_content_t "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/srv/samba(/.*)?"')]),s._v("\nsemanage fcontext "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/srv/samba'")]),s._v("\n/srv/samba"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?            all files   system_u:object_r:public_content_t:s0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/selinux/targeted/contexts/files/file_contexts.local\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This file is auto-generated by libsemanage")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Please use the semanage command to make changes")]),s._v("\n/srv/samba"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/.*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?    system_u:object_r:public_content_t:s0  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#写入这个档案")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("restorecon "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Rv")]),s._v(" /srv/samba* "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#尝试恢复默认值")]),s._v("\nll "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Zd")]),s._v(" /srv/samba\ndrwxr-xr-x  root root system_u:object_r:public_content_t /srv/samba/  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#有默认值，以后用restorecon命令来修改比较简单！")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("semanage命令的功能很多，这里主要用到的仅有fcontext这个选项的用法而已。如上所示，你可以使用semanage来查询所有的目录默认值，也能够使用它来增加默认值的设置！")])])}),[],!1,null,null,null);a.default=e.exports}}]);